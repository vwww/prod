(function(b,e){"function"===typeof define&&define.amd?define(["leaflet"],b):"object"===typeof exports&&(module.exports=b(require("leaflet")));"undefined"!==typeof e&&e.L&&(e.L.Control.MiniMap=b(L),e.L.control.minimap=function(a,c){return new e.L.Control.MiniMap(a,c)})})(function(b){var e=b.Control.extend({includes:b.Evented?b.Evented.prototype:b.Mixin.Events,options:{position:"bottomright",toggleDisplay:!1,zoomLevelOffset:-5,zoomLevelFixed:!1,centerFixed:!1,zoomAnimation:!1,autoToggleDisplay:!1,minimized:!1,width:150,height:150,collapsedWidth:19,collapsedHeight:19,aimingRectOptions:{color:"#ff7800",weight:1,clickable:!1},shadowRectOptions:{color:"#000000",weight:1,clickable:!1,opacity:0,fillOpacity:0},strings:{hideText:"Hide MiniMap",showText:"Show MiniMap"},mapOptions:{}},initialize:function(a,c){b.Util.setOptions(this,c);this.options.aimingRectOptions.clickable=!1;this.options.shadowRectOptions.clickable=!1;this._layer=a},onAdd:function(a){this._mainMap=a;this._container=b.DomUtil.create("div","leaflet-control-minimap");this._container.style.width=this.options.width+"px";this._container.style.height=this.options.height+"px";b.DomEvent.disableClickPropagation(this._container);b.DomEvent.on(this._container,"mousewheel",b.DomEvent.stopPropagation);a={attributionControl:!1,dragging:!this.options.centerFixed,zoomControl:!1,zoomAnimation:this.options.zoomAnimation,autoToggleDisplay:this.options.autoToggleDisplay,touchZoom:this.options.centerFixed?"center":!this._isZoomLevelFixed(),scrollWheelZoom:this.options.centerFixed?"center":!this._isZoomLevelFixed(),doubleClickZoom:this.options.centerFixed?"center":!this._isZoomLevelFixed(),boxZoom:!this._isZoomLevelFixed(),crs:a.options.crs};a=b.Util.extend(this.options.mapOptions,a);this._miniMap=new b.Map(this._container,a);this._miniMap.addLayer(this._layer);this._minimized=this._userToggledDisplay=this._miniMapMoving=this._mainMapMoving=!1;this.options.toggleDisplay&&this._addToggleButton();this._miniMap.whenReady(b.Util.bind(function(){this._aimingRect=b.rectangle(this._mainMap.getBounds(),this.options.aimingRectOptions).addTo(this._miniMap);this._shadowRect=b.rectangle(this._mainMap.getBounds(),this.options.shadowRectOptions).addTo(this._miniMap);this._mainMap.on("moveend",this._onMainMapMoved,this);this._mainMap.on("move",this._onMainMapMoving,this);this._miniMap.on("movestart",this._onMiniMapMoveStarted,this);this._miniMap.on("move",this._onMiniMapMoving,this);this._miniMap.on("moveend",this._onMiniMapMoved,this)},this));return this._container},addTo:function(a){b.Control.prototype.addTo.call(this,a);a=this.options.centerFixed||this._mainMap.getCenter();this._miniMap.setView(a,this._decideZoom(!0));this._setDisplay(this.options.minimized);return this},onRemove:function(a){this._mainMap.off("moveend",this._onMainMapMoved,this);this._mainMap.off("move",this._onMainMapMoving,this);this._miniMap.off("moveend",this._onMiniMapMoved,this);this._miniMap.removeLayer(this._layer)},changeLayer:function(a){this._miniMap.removeLayer(this._layer);this._layer=a;this._miniMap.addLayer(this._layer)},_addToggleButton:function(){this._toggleDisplayButton=this.options.toggleDisplay?this._createButton("",this._toggleButtonInitialTitleText(),"leaflet-control-minimap-toggle-display leaflet-control-minimap-toggle-display-"+this.options.position,this._container,this._toggleDisplayButtonClicked,this):void 0;this._toggleDisplayButton.style.width=this.options.collapsedWidth+"px";this._toggleDisplayButton.style.height=this.options.collapsedHeight+"px"},_toggleButtonInitialTitleText:function(){return this.options.minimized?this.options.strings.showText:this.options.strings.hideText},_createButton:function(a,c,d,f,g,h){d=b.DomUtil.create("a",d,f);d.innerHTML=a;d.href="#";d.title=c;a=b.DomEvent.stopPropagation;b.DomEvent.on(d,"click",a).on(d,"mousedown",a).on(d,"dblclick",a).on(d,"click",b.DomEvent.preventDefault).on(d,"click",g,h);return d},_toggleDisplayButtonClicked:function(){this._userToggledDisplay=!0;this._minimized?this._restore():this._minimize()},_setDisplay:function(a){a!==this._minimized&&(this._minimized?this._restore():this._minimize())},_minimize:function(){this.options.toggleDisplay?(this._container.style.width=this.options.collapsedWidth+"px",this._container.style.height=this.options.collapsedHeight+"px",this._toggleDisplayButton.className+=" minimized-"+this.options.position,this._toggleDisplayButton.title=this.options.strings.showText):this._container.style.display="none";this._minimized=!0;this._onToggle()},_restore:function(){this.options.toggleDisplay?(this._container.style.width=this.options.width+"px",this._container.style.height=this.options.height+"px",this._toggleDisplayButton.className=this._toggleDisplayButton.className.replace("minimized-"+this.options.position,""),this._toggleDisplayButton.title=this.options.strings.hideText):this._container.style.display="block";this._minimized=!1;this._onToggle()},_onMainMapMoved:function(a){this._miniMapMoving?this._miniMapMoving=!1:(a=this.options.centerFixed||this._mainMap.getCenter(),this._mainMapMoving=!0,this._miniMap.setView(a,this._decideZoom(!0)),this._setDisplay(this._decideMinimized()));this._aimingRect.setBounds(this._mainMap.getBounds())},_onMainMapMoving:function(a){this._aimingRect.setBounds(this._mainMap.getBounds())},_onMiniMapMoveStarted:function(a){if(!this.options.centerFixed){var c=this._aimingRect.getBounds();a=this._miniMap.latLngToContainerPoint(c.getSouthWest());c=this._miniMap.latLngToContainerPoint(c.getNorthEast());this._lastAimingRectPosition={sw:a,ne:c}}},_onMiniMapMoving:function(a){this.options.centerFixed||this._mainMapMoving||!this._lastAimingRectPosition||(this._shadowRect.setBounds(new b.LatLngBounds(this._miniMap.containerPointToLatLng(this._lastAimingRectPosition.sw),this._miniMap.containerPointToLatLng(this._lastAimingRectPosition.ne))),this._shadowRect.setStyle({opacity:1,fillOpacity:.3}))},_onMiniMapMoved:function(a){this._mainMapMoving?this._mainMapMoving=!1:(this._miniMapMoving=!0,this._mainMap.setView(this._miniMap.getCenter(),this._decideZoom(!1)),this._shadowRect.setStyle({opacity:0,fillOpacity:0}))},_isZoomLevelFixed:function(){var a=this.options.zoomLevelFixed;return this._isDefined(a)&&this._isInteger(a)},_decideZoom:function(a){if(this._isZoomLevelFixed())return a?this.options.zoomLevelFixed:this._mainMap.getZoom();if(a)return this._mainMap.getZoom()+this.options.zoomLevelOffset;a=this._miniMap.getZoom()-this._mainMap.getZoom();var c=this._miniMap.getZoom()-this.options.zoomLevelOffset;a>this.options.zoomLevelOffset&&this._mainMap.getZoom()<this._miniMap.getMinZoom()-this.options.zoomLevelOffset?this._miniMap.getZoom()>this._lastMiniMapZoom?(a=this._mainMap.getZoom()+1,this._miniMap.setZoom(this._miniMap.getZoom()-1)):a=this._mainMap.getZoom():a=c;this._lastMiniMapZoom=this._miniMap.getZoom();return a},_decideMinimized:function(){return this._userToggledDisplay?this._minimized:this.options.autoToggleDisplay?this._mainMap.getBounds().contains(this._miniMap.getBounds())?!0:!1:this._minimized},_isInteger:function(a){return"number"===typeof a},_isDefined:function(a){return"undefined"!==typeof a},_onToggle:function(){b.Util.requestAnimFrame(function(){b.DomEvent.on(this._container,"transitionend",this._fireToggleEvents,this);b.Browser.any3d||b.Util.requestAnimFrame(this._fireToggleEvents,this)},this)},_fireToggleEvents:function(){b.DomEvent.off(this._container,"transitionend",this._fireToggleEvents,this);var a={minimized:this._minimized};this.fire(this._minimized?"minimize":"restore",a);this.fire("toggle",a)}});b.Map.mergeOptions({miniMapControl:!1});b.Map.addInitHook(function(){this.options.miniMapControl&&(this.miniMapControl=(new e).addTo(this))});return e},window)