(()=>{"use strict";var e,t={403:(e,t,s)=>{class i{constructor(){this.x=0,this.y=0,this.xe=0,this.ye=0,this.reset()}reset(){this.x=0,this.y=0,this.xe=0,this.ye=0}move(e){const t=Math.pow(.001,e/1e3);this.xe*=t,this.ye*=t}setServerLocation(e,t){this.xe+=this.x-e,this.ye+=this.y-t,this.x=e,this.y=t}}class n extends i{respawn(e){this.x=e?r:o,this.y=c,this.xe=0,this.ye=0}}class a extends i{constructor(){super(...arguments),this.name="",this.color="#7f0",this.score=0,this.ping=-1}respawn(e){this.reset(),this.x=e?r:o}}const r=.45,o=2-r,c=.5;var h,l;!function(e){e[e.IN_PLAY=0]="IN_PLAY",e[e.WIN=1]="WIN",e[e.LOSS=2]="LOSS"}(h||(h={}));class d{constructor(){this.status=h.IN_PLAY,this.p1=new a,this.p2=new a,this.ball=new n,this.smoothDelay=1e3,this.hasServerOpponent=!1,this.p1.respawn(!0),this.p2.respawn(!1),this.ball.respawn(!0)}update(e){this.smoothDelay=(4*this.smoothDelay+e)/5,e&&(this.ball.move(e),this.p1.move(e),this.p2.move(e))}getP1(){return this.p1}getP2(){return this.p2}getBall(){return this.ball}getStatus(){return this.status}getSmoothDelay(){return this.smoothDelay}getFPS(){return 1e3/Math.max(this.smoothDelay,.5)}hasOpponent(){return this.hasServerOpponent}setName(e){this.p1.name=e}setColor(e){this.p1.color=e}processServerDisconnect(){this.p1.ping=this.p2.ping=-1}processServerWelcome(e,t){this.p1.color=e,this.p1.name=t}processServerState(e,t,s,i,n,a){this.p1.setServerLocation(e,t),this.p2.setServerLocation(s,i),this.ball.setServerLocation(n,a)}processServerEnter(e,t){this.hasServerOpponent=!0,this.p1.score=this.p2.score=0,this.p2.color=e,this.p2.name=t}processServerLeave(){this.hasServerOpponent=!1}processServerWin(){this.p1.score++,this.status=h.WIN}processServerLose(){this.p2.score++,this.status=h.LOSS}processServerRoundStart(e){this.p1.respawn(!0),this.p2.respawn(!1),this.ball.respawn(e),this.status=h.IN_PLAY}processServerPingTimes(e,t){this.p1.ping=e,this.p2.ping=t}}function g(e){return function(e){return document.getElementById(e)}(e)}function p(e){return"#"+("00000"+e.toString(16)).slice(-6)}function m(e,t,s){return Math.max(t,Math.min(e,s))}!function(e){e[e.Connecting=0]="Connecting",e[e.Connected=1]="Connected",e[e.Disconnecting=2]="Disconnecting",e[e.Disconnected=3]="Disconnected"}(l||(l={})),s(346);class u{constructor(e){this.game=e,this.state=l.Disconnected,this.lastKeySent=-1}isConnected(){return this.readyState()!==l.Disconnected}readyState(){return this.state}connect(){this.disconnect(),this.state=l.Connecting;const e=e=>{console.log(e),this.disconnected()};PlayerIO.authenticate("slime-fd3iliszksmlav83stww","public",{userId:"guest"},{},(t=>{this.state=l.Connected,t.multiplayer.developmentServer="localhost:8184";const s=()=>{t.multiplayer.createJoinRoom("$service-room$","match",!1,null,null,(e=>{this.connection=e,e.addMessageCallback("m",(t=>{i(t.getString(0)),e.disconnect()}))}),e)},i=i=>{t.multiplayer.createJoinRoom(i,"slime",!0,null,null,(e=>{this.connection=e,e.addDisconnectCallback((()=>{this.game.processServerLeave(),s()})),e.addMessageCallback("welcome",(e=>{const t=p(16777215&e.getUInt(0)),s=e.getString(1);this.game.processServerWelcome(t,s)})),e.addMessageCallback("s",(e=>{const t=65535,s=e.getByteArray(0),i=(s[1]<<8|s[2])/t,n=(s[3]<<8|s[4])/t,a=2-(s[7]<<8|s[8])/t,r=(s[9]<<8|s[10])/t,o=(s[13]<<8|s[14])/t*2,c=(s[15]<<8|s[16])/t;this.game.processServerState(i,n,a,r,o,c)})),e.addMessageCallback("enter",(e=>{const t=p(16777215&e.getUInt(0)),s=e.getString(1);this.game.processServerEnter(t,s),this.lastKeySent=-1})),e.addMessageCallback("win",(()=>this.game.processServerWin())),e.addMessageCallback("lose",(()=>this.game.processServerLose())),e.addMessageCallback("nextRound",(e=>this.game.processServerRoundStart(e.getBoolean(0)))),e.addMessageCallback("t",(e=>{this.game.processServerPingTimes(e.getUInt(0),e.getUInt(1))})),e.addMessageCallback("p",(t=>e.sendMessage(t)));const t=this.game.getUserName(),i=this.game.getUserColor();e.send("init",i,t)}),e)};s()}),e),this.game.processServerConnect()}disconnect(){this.connection&&(this.state=l.Disconnecting,this.connection.addDisconnectCallback((()=>this.disconnected())),this.connection.disconnect())}update(){if(!this.connection)return;if(!this.game.shouldSendNetworkUpdate())return;const e=this.game.getKeyFlags();this.lastKeySent!==e&&this.connection.send("k",e)}disconnected(){this.state=l.Disconnected,this.connection=void 0,this.game.processServerDisconnect()}}class v{constructor(){this.x=Math.random(),this.y=Math.random(),this.vx=Math.floor(7*Math.random()-3)/800*.06,this.vy=Math.floor(3*Math.random()+1)/400*.06,this.rgb=16777215*Math.random()|0,this.a=.6*Math.random()+.1,this.blurSize=(Math.floor(10*Math.random())+5)/2/800,this.scale=.7*Math.random()+.3}}class w{constructor(e=40){this.fancy=new Array(e).fill(void 0).map((e=>new v))}update(e){if(e)for(let t=0;t<this.fancy.length;++t)this.fancy[t].x+=this.fancy[t].vx*e,this.fancy[t].y+=this.fancy[t].vy*e,(this.fancy[t].x<-.0375||this.fancy[t].x>1.0375)&&(this.fancy[t].x%=1.075),this.fancy[t].x<-.0375&&(this.fancy[t].x+=1.075),this.fancy[t].y>.875&&(this.fancy[t].y-=.95)}draw(e,t,s){e.save(),e.globalCompositeOperation="screen";for(let i=0;i<this.fancy.length;++i){const{x:n,y:a,a:r,blurSize:o,scale:c}=this.fancy[i],h=this.fancy[i].rgb>>16,l=this.fancy[i].rgb>>8&255,d=255&this.fancy[i].rgb;e.beginPath(),e.arc(n*t,a*s,.0375*c*t,0,2*Math.PI),e.closePath(),e.filter="blur("+o*c*t+"px)",e.fillStyle="rgba("+h+","+l+","+d+","+r+")",e.fill()}e.restore()}}class f{constructor(e,t){this.game=e,this.getNetStatus=t,this.drawFancyBackground=!1,this.drawDev=!1,this.flipP1=!1,this.fancy=new w}draw(e){const t=e.canvas.height,s=2*t;if(this.drawClear(e,s,t),this.drawFancyBackground&&this.fancy.draw(e,s,t),!this.game)return;this.drawFloor(e,s,t),this.drawNet(e,s,t),this.drawBall(e,s,t);const i=this.game.getP1(),n=this.game.getP2();let a;switch(this.drawSlimer(e,s,t,i.x+i.xe,i.y+i.ye,i.color,i.name,!1),this.game.hasOpponent()&&(this.drawSlimer(e,s,t,n.x+n.xe,n.y+n.ye,n.color,n.name,!0),this.drawPing(e,s,t,i.ping,!this.flipP1),this.drawPing(e,s,t,n.ping,this.flipP1)),this.drawDev&&(this.drawBall(e,s,t,!0),this.drawSlimer(e,s,t,i.x,i.y,i.color,i.name,!1,!0),this.drawSlimer(e,s,t,n.x,n.y,n.color,n.name,!0,!0)),this.drawScore(e,s,t,i.score,n.score),this.getNetStatus()){case l.Connecting:a="Connecting";break;case l.Connected:this.game.hasOpponent()?this.game.getStatus()===h.WIN?a="You won the round!":this.game.getStatus()===h.LOSS&&(a="You lost the round!"):a="Waiting for opponent";break;case l.Disconnecting:a="Disconnecting";break;case l.Disconnected:a="Disconnected"}a&&this.drawStatus(e,s,t,a),this.drawFPS(e,s,t)}drawClear(e,t,s){const i=e.createRadialGradient(t/2,s/2,0,t/2,s/2,s);i.addColorStop(0,"#0df"),i.addColorStop(1,"#26b"),e.fillStyle=i,e.fillRect(0,0,t,s)}drawFloor(e,t,s){e.fillStyle="#999",e.fillRect(0,.8*s,t,s)}drawNet(e,t,s){e.fillStyle="#fff",e.fillRect(.495*t,.625*s,.01*t,.2*s)}drawBall(e,t,s,i){const n=this.game.getBall();let a=n.x,r=n.y;if(i||(a+=n.xe,r+=n.ye),this.flipP1&&(a=2-a),r=1-r-.2,e.beginPath(),e.arc(a*s,r*s,.03*s,0,2*Math.PI),e.closePath(),i)return e.lineWidth=2,e.strokeStyle="red",void e.stroke();e.fillStyle=this.game.getStatus()===h.WIN?"#0f0":this.game.getStatus()===h.LOSS?"red":"#ff0",e.fill()}drawSlimer(e,t,s,i,n,a,r,o,c){const h=this.game.getBall();if(this.flipP1&&(i=2-i),n=1-n-.2,e.beginPath(),e.arc(i*s,n*s,.1*s,0,Math.PI,!0),e.closePath(),c)return e.lineWidth=2,e.strokeStyle="red",void e.stroke();e.fillStyle=a,e.fill();let l=i+(this.flipP1!==o?-.0535:.0535),d=n-.0525;e.beginPath(),e.arc(l*s,d*s,.0175*s,0,2*Math.PI,!0),e.closePath(),e.fillStyle="#fff",e.fill();const g=(this.flipP1?2-(h.x+h.xe):h.x+h.xe)-l,p=1-(h.y+h.ye)-.2-d,m=g*g+p*p;if(m>25e-6){const e=.005/Math.sqrt(m);l+=g*e,d+=p*e}else l=h.x+h.xe,d=h.y+h.ye;e.beginPath(),e.arc(l*s,d*s,.01*s,0,2*Math.PI,!0),e.closePath(),e.fillStyle="#000",e.fill(),r&&(e.font=.0225*t+"px Verdana, sans-serif",e.textAlign="center",e.fillStyle="#ccc",e.fillText(r,i*s,(n-.05-.1)*s))}drawScore(e,t,s,i,n){e.font=.05*t+"px sans-serif",e.textAlign="center",e.fillStyle="#fd0",e.fillText(i+"",(this.flipP1?.92:.08)*t,.15*s),e.fillText(n+"",(this.flipP1?.08:.92)*t,.15*s)}drawStatus(e,t,s,i){e.font=.04*t+"px sans-serif",e.textAlign="center",e.fillStyle="#ddd",e.fillText(i,.5*t,.15*s)}drawFPS(e,t,s){if(!this.game)return;const i=this.game.getFPS();e.font=.02*t+"px monospace",e.textAlign="left",e.fillStyle="#fa0",e.fillText(Math.round(i)+" fps",.01*t,.97*s)}drawPing(e,t,s,i,n){i<0||(e.font=.02*t+"px monospace",e.textAlign=n?"left":"right",e.fillStyle="#fa0",e.fillText(i+" ms",(n?.01:.99)*t,.85*s))}}class S{constructor(e,t){this.canvas=e,this.animationCallback=t,this.lastGameTime=Date.now(),this.context=e.getContext("2d"),window.requestAnimationFrame((()=>this.drawFrame())),document.addEventListener("fullscreenchange",(()=>this.resize())),window.addEventListener("resize",(()=>this.resize())),this.resize()}getCanvas(){return this.canvas}getContext(){return this.context}resize(){if(window.innerWidth===window.screen.width&&window.innerHeight===window.screen.height)this.canvas.width=Math.min(window.innerWidth,2*window.innerHeight),this.canvas.height=Math.min(window.innerHeight,window.innerWidth/2);else{const e=this.canvas.parentNode;this.canvas.width=Math.min(e.clientWidth,2*e.clientHeight),this.canvas.height=Math.min(e.clientHeight,e.clientWidth/2)}}drawFrame(){window.requestAnimationFrame((()=>this.drawFrame()));const e=Date.now(),t=e-this.lastGameTime;this.lastGameTime=e,this.animationCallback(t)}}class y{constructor(){this.keys={}}on(e){this.keys[e]=!0}off(e){delete this.keys[e]}isOn(e){return e in this.keys}attachListeners(e,t){e.addEventListener("keydown",(e=>{this.on(e.keyCode),t()})),e.addEventListener("keyup",(e=>{this.off(e.keyCode),t()}))}}class x{constructor(){this.x=0,this.y=0,this.valid=!1}isValid(){return this.valid}getX(){return this.x}getY(){return this.y}attachListeners(e){e.addEventListener("mousemove",(t=>this.movestart(t.clientX,t.clientY,e))),e.addEventListener("touchmove",(t=>this.touchmove(t,e))),e.addEventListener("mouseleave",(()=>this.movestop())),e.addEventListener("touchend",(()=>this.movestop())),e.addEventListener("touchcancel",(()=>this.movestop()))}movestart(e,t,s){this.x=m((e-s.getBoundingClientRect().left)/s.width,0,1),this.y=m((t-s.getBoundingClientRect().top)/s.height,0,1),this.valid=!0}movestop(){this.valid=!1}touchmove(e,t){if(e.targetTouches.length<1)return;e.preventDefault();const s=e.targetTouches.item(0);s&&this.movestart(s.clientX,s.clientY,t)}}class k{constructor(){this.keyManager=new y,this.keyFlags=0,this.keyFlagsFlip=0,this.mouseManager=new x}getKeyFlags(e){return e?this.keyFlagsFlip:this.keyFlags}getMouse(){return this.mouseManager}KeyL(){return this.keyManager.isOn(37)||this.keyManager.isOn(65)}KeyU(){return this.keyManager.isOn(38)||this.keyManager.isOn(87)}KeyR(){return this.keyManager.isOn(39)||this.keyManager.isOn(68)}updateKeyFlags(){const e=this.KeyL()?1:0,t=this.KeyR()?1:0,s=this.KeyU()?1:0;this.keyFlags=0|e|t<<1|s<<2,this.keyFlagsFlip=0|t|e<<1|s<<2}attachListeners(e){this.keyManager.attachListeners(e,(()=>this.updateKeyFlags()))}}class C{constructor(e){this.game=e,this.$canvas=g("gameCanvas"),this.$pName=g("pName"),this.$pColor=g("pColor"),this.$connect=g("connect"),this.$flipP1=g("flipP1"),this.$notFlipP1=g("notFlipP1"),this.$background=g("background"),this.$devMode=g("devMode"),this.$fullscreen=g("fullscreen"),this.canvasGame=new S(this.$canvas,(e=>this.game.processUIupdate(e))),this.input=new k,this.input.attachListeners(window),g("connect").addEventListener("click",(()=>this.game.processUIconnect())),g("fullscreen").addEventListener("click",(()=>{this.$fullscreen.checked=!1,this.canvasGame.getCanvas().requestFullscreen()})),this.$pName.addEventListener("change",(()=>{const e=this.$pName.value;this.game.processUIchangeName(e),window.localStorage.n=e})),this.$pColor.addEventListener("change",(()=>{const e=this.$pColor.value;this.game.processUIchangeColor(p(parseInt(e,16))),window.localStorage.c=e})),this.$flipP1.addEventListener("change",(()=>{const e=this.$flipP1.checked;this.game.processUIchangeFlipP1(e),window.localStorage.f=e?"1":"0"})),this.$notFlipP1.addEventListener("change",(()=>{const e=!this.$notFlipP1.checked;this.game.processUIchangeFlipP1(e),window.localStorage.f=e?"1":"0"})),this.$background.addEventListener("change",(()=>{const e=this.$background.checked;this.game.processUIchangeFancyBackground(e),window.localStorage.b=e?"1":"0"})),this.$devMode.addEventListener("change",(()=>{const e=this.$devMode.checked;this.game.processUIchangeDrawDev(e),window.localStorage.d=e?"1":"0"}))}getContext(){return this.canvasGame.getContext()}getUserName(){return this.$pName.value}getUserColor(){const e=parseInt(this.$pColor.value,16);return Number.isNaN(e)?7864064:16777215&e}setUserName(e){this.$pName.value=e}setUserColor(e){this.$pColor.value=e}getInputManager(){return this.input}restoreSettings(){window.localStorage.n&&this.game.processUIchangeName(this.$pName.value=window.localStorage.n),window.localStorage.c&&this.game.processUIchangeColor(p(this.$pColor.value=window.localStorage.c)),"1"===window.localStorage.f&&this.game.processUIchangeFlipP1(this.$flipP1.checked=!0),"1"===window.localStorage.b&&this.game.processUIchangeFancyBackground(this.$background.checked=!0),"1"===window.localStorage.d&&this.game.processUIchangeDrawDev(this.$devMode.checked=!0)}processServerConnect(){this.$pName.disabled=!0,this.$pColor.disabled=!0,this.$connect.innerHTML="Disconnect",this.$connect.className="btn btn-danger"}processServerDisconnect(){this.$pName.disabled=!1,this.$pColor.disabled=!1,this.$connect.innerHTML="Connect",this.$connect.className="btn btn-primary"}}class b{constructor(){this.game=new d,this.ui=new C(this),this.net=new u(this),this.gameDrawer=new f(this.game,(()=>this.net.readyState())),this.ui.restoreSettings()}processUIupdate(e){this.game.update(e),this.net.update(),this.gameDrawer.fancy.update(e),this.gameDrawer.draw(this.ui.getContext())}processUIconnect(){this.net.isConnected()?this.net.disconnect():this.net.connect()}processUIchangeName(e){this.net.isConnected()||this.game.setName(e)}processUIchangeColor(e){this.net.isConnected()||this.game.setColor(e)}processUIchangeFlipP1(e){this.gameDrawer.flipP1=e}processUIchangeFancyBackground(e){this.gameDrawer.drawFancyBackground=e}processUIchangeDrawDev(e){this.gameDrawer.drawDev=e}getUserName(){return this.ui.getUserName()}getUserColor(){return this.ui.getUserColor()}getKeyFlags(){const e=this.gameDrawer.flipP1;let t=this.ui.getInputManager().getKeyFlags(e);const s=this.ui.getInputManager().getMouse();if(s.isValid()){let i=s.getX();e&&(i=1-i);const n=Math.min(Math.max(2*i,0),1),a=s.getY()<.45,r=this.game.getP1().x;!(3&t)&&Math.abs(r-n)>.05&&(t|=r<n?2:1),a&&(t|=4)}return t}shouldSendNetworkUpdate(){return this.game.hasOpponent()}processServerConnect(){this.ui.processServerConnect()}processServerDisconnect(){this.game.processServerDisconnect(),this.ui.processServerDisconnect()}processServerWelcome(e,t){this.game.processServerWelcome(e,t)}processServerState(e,t,s,i,n,a){this.game.processServerState(e,t,s,i,n,a)}processServerEnter(e,t){this.game.processServerEnter(e,t)}processServerLeave(){this.game.processServerLeave()}processServerWin(){this.game.processServerWin()}processServerLose(){this.game.processServerLose()}processServerRoundStart(e){this.game.processServerRoundStart(e)}processServerPingTimes(e,t){this.game.processServerPingTimes(e,t)}}var M;M=()=>{new b},document.addEventListener("DOMContentLoaded",M)}},s={};function i(e){var n=s[e];if(void 0!==n)return n.exports;var a=s[e]={exports:{}};return t[e](a,a.exports,i),a.exports}i.m=t,e=[],i.O=(t,s,n,a)=>{if(!s){var r=1/0;for(h=0;h<e.length;h++){for(var[s,n,a]=e[h],o=!0,c=0;c<s.length;c++)(!1&a||r>=a)&&Object.keys(i.O).every((e=>i.O[e](s[c])))?s.splice(c--,1):(o=!1,a<r&&(r=a));o&&(e.splice(h--,1),t=n())}return t}a=a||0;for(var h=e.length;h>0&&e[h-1][2]>a;h--)e[h]=e[h-1];e[h]=[s,n,a]},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={66:0};i.O.j=t=>0===e[t];var t=(t,s)=>{var n,a,[r,o,c]=s,h=0;for(n in o)i.o(o,n)&&(i.m[n]=o[n]);if(c)var l=c(i);for(t&&t(s);h<r.length;h++)a=r[h],i.o(e,a)&&e[a]&&e[a][0](),e[r[h]]=0;return i.O(l)},s=self.webpackChunkvwww=self.webpackChunkvwww||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))})();var n=i.O(void 0,[0],(()=>i(403)));n=i.O(n)})();